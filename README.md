# AppImageUpdate-Exploit-001-POC
A Possible exploit POC

Here is the Proof-Of-Concept of the exploit -> https://youtu.be/PbNthAK2WKQ

Quoting from the original issue post,

This is just a Hypothesis, no experiments so far.

Let's say you have a AppImage without GPG signs(not so uncommon) and it points to some url. Let's say a domain or Github. **Let us assume that the attacker has found a way to somehow edit the update channels (DNS Spoofing?, or DNS hack so to redirect to his evil server?).**

Now if he releases a new release but now he does the following,

* Use the legacy zsync tool to generate a zsync file of a bash script.
* Now edits the Filename entry to **.bashrc**
* Now renames his bash script to **.bashrc** 
* Uploads all required files to Github or the release channel.

Now let us assume a AppImage is updated from the Home directory. AppImageUpdate would simply sync from the update channels and when every checksum is verified it will **rename the file to the target file name as given in the zsync file**. Now the updater is pointing to the home directory as the output directory. 

**The important thing to note here is that AppImageUpdate moves the old file i.e moves the original .bashrc file in home to .bashrc.zs-old and renames the temporary file(which is a bash script) to .bashrc**.

It is worthy to note that the **Qt version** of the updater does not do this. I've implemented this many years ago when the library was first created.

> Does not touch the host system , like AppImageUpdate does(i.e AppImageUpdate sometimes deletes user files without any content integrity checks but this library does not touch the host machine at all , if the target file name exists it will rename the new target file with the current date time in ISO 8601 format placed in the middle of the filename , Thus avoiding deleting any files in the host machine.)

**But if .bashrc does not exists then even my library is vulnerable to this exploit.**

*Now the attacker has exploited the user and can launch the attack once the user opens the terminal or just logs in? i.e whenever the .bashrc is executed*

Some users of linux can find this but not the layman.

**If you say you can check if the downloaded file is a AppImage, I've spoofed the update tool to think a bash script is AppImage and still run as .bashrc**.

```
# Warning don't execute this in home directory
dd if=appimagetool.AppImage of=.bashrc iflag=count_bytes count=11
```

Now simply write your bash code after 10 or so lines I guess, I wrote it right after the binary stuff and it still works.

**Please correct me if I'm wrong and please verify if this hypothesis can be implemented**. You can say that if the server gets hacked then the AppImage itself can be made into an exploit but if it runs from Firejail even with a simple profile then this exploit is useless. But the attacker can gain some sort of advantage by doing the hack this way since AppImageUpdate is not run inside the Firejail generally. I think the default settings of AppImageLauncher does store the AppImages away from Home directory which makes this exploit useless here.

But assume if the developer itself is evil then he/she builds some sort of trust and release first 10 releases clean without anything suspicious and one release he decides to exploit everyone. So does this intentionally. **Again to note, if a AppImage is run from Firejail simple attacks like this can be mitigated, but this type of vulnerability allows the attacker to somehow bypass this because of a flaw in the AppImageUpdate**

**CC**: @TheAssassin 
